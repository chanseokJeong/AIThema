# 시간외 거래(After-Hours Trading) 개발 계획 (Unified View)

이 문서는 정규장 종료 후(16:00 ~ 18:00) 진행되는 **'시간외 단일가 매매'** 데이터를 기존 화면에 **병합(Merge)**하여 보여주기 위한 개발 계획입니다. 별도의 모드 전환 없이 자연스럽게 정보를 노출합니다.

---

## 1. 🎯 목표 (Objective)

- **모드 전환 없음**: 사용자가 별도로 모드를 바꿀 필요 없이, 시간외 거래가 발생하면 자동으로 정보가 추가됨.
- **통합 뷰**: 정규장 등락률과 시간외 등락률을 한 눈에 비교 가능하도록 표시.

---

## 2. 📊 데이터 수집 전략 (Data Strategy)

### 2.1 데이터 구조 확장
기존 `stock` 객체에 시간외 필드를 추가합니다.
```javascript
{
  name: "삼성전자",
  price: 70000,       // 정규장 종가
  rate: 1.5,          // 정규장 등락률
  afterHoursPrice: 70500, // 시간외 현재가 (없으면 null)
  afterHoursRate: 0.7     // 시간외 등락률 (없으면 null)
}
```

### 2.2 수집 로직 (16:00 ~ 18:00)
- 정규장 데이터 수집 후, **시간외 시세 API**를 추가로 호출하여 데이터 병합.
- 시간외 거래량이 미미하거나 변동이 없는 경우 `afterHoursRate: 0` 또는 `null` 처리.

---

## 3. 🛠️ 백엔드 개발 계획 (Backend)

### 3.1 `market.js` 업데이트
- `fetchStockPrice` 함수 수정:
    - 16:00 이후에는 정규장 데이터 + **시간외 데이터**를 함께 조회하여 반환.
    - 시간외 데이터가 존재할 경우 객체에 포함.

### 3.2 랭킹 로직 보정
- **가중치 적용**: 16:00 이후 테마 랭킹 산정 시, 시간외 급등 종목에 가산점 부여.
- 예: `Score = 정규장_등락률 + (시간외_등락률 * 1.5)` (시간외 변동성을 더 중요하게 반영)

---

## 4. 💻 프론트엔드 개발 계획 (Frontend)

### 4.1 ThemeCard UI 수정
- **시간외 정보 추가 표시**:
    - 종목 리스트의 각 행에 **시간외 등락률**을 별도 뱃지나 텍스트로 표시.
    - 예: `삼성전자 +1.5%` `(시간외 +0.7%)` 
- **시각적 강조**:
    - 시간외에서 급등(`+2%` 이상)한 종목은 배경색이나 테두리로 강조(Highlight).
    - Rate Bar에 **시간외 변동폭**을 덧붙여서 표시 (Stacked Bar 형태 고려).

### 4.2 필터링 옵션
- 상단에 **"시간외 변동 포함 정렬"** 체크박스 제공 (선택 사항).

---

## 5. 📅 단계별 실행 계획 (Action Plan)

### Phase 1: 백엔드 데이터 확장
- [ ] `market.js`에서 시간외 데이터 수집 로직 추가 (병렬 처리).
- [ ] API 응답 스키마에 `afterHours` 필드 추가.

### Phase 2: 프론트엔드 UI 개선
- [ ] `ThemeCard.jsx` 수정: `stock.afterHoursRate`가 있을 경우 UI에 렌더링.
- [ ] 시간외 급등 종목 강조 스타일링 (`App.css`).

### Phase 3: 통합 테스트
- [ ] 16:00 ~ 18:00 구간에 정규장 데이터와 시간외 데이터가 동시에 잘 표시되는지 확인.

---

## 6. 💡 기대 효과
- 사용자는 정규장 마감 후에도 **"내일 뜰 종목"**을 미리 파악할 수 있음.
- 별도 페이지 이동 없이 **연속적인 시장 흐름** 파악 가능.
